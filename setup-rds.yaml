tosca_definitions_version: cloudify_dsl_1_3


imports:
  - https://cloudify.co/spec/cloudify/5.1.0/types.yaml
  - CLUSTER_A--application.yaml
  - CLUSTER_B--application.yaml
  - CERTIFICATE--certificate.yaml
  - load-balancer.yaml


node_templates:

  CERTIFICATE--kubernetes-certificate-secret-A:
    relationships:
      - type: cloudify.relationships.depends_on
        target: load_balancer_dns_terraform
      - type: cloudify.kubernetes.relationships.managed_by_master
        target: CLUSTER_A--master

  CERTIFICATE--kubernetes-certificate-secret-B:
    relationships:
      - type: cloudify.relationships.depends_on
        target: load_balancer_dns_terraform
      - type: cloudify.kubernetes.relationships.managed_by_master
        target: CLUSTER_B--master


capabilities:

  app_url:
    value: { get_input: CERTIFICATE--domain_name }

  ssl_certificate:
    description: SSL certificate in base64 format
    value: { get_attribute: [CERTIFICATE--cert_generation, cert_base64] }

  ssl_key:
    description: SSL key in base64 format
    value: { get_attribute: [CERTIFICATE--cert_generation, key_base64] }
