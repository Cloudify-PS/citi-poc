tosca_definitions_version: cloudify_dsl_1_3


node_templates:

  LOAD_BALANCER--load_balancer_dns_terraform:
    properties:
      resource_config:
        variables:
          domain_name: { get_input: CERTIFICATE--domain_name }
          zone_id: { get_input: CERTIFICATE--hosted_zone_id }
          vpc_id: { get_attribute: [CLUSTER_A--RDS--openshift_cluster, network_config, vpc, id] }
          public_subnet_id: { get_attribute: [CLUSTER_A--RDS--openshift_cluster, network_config, public_subnet] }
    relationships:
      - target: CERTIFICATE--dns_record_remove
        type: cloudify.relationships.depends_on
      - target: CLUSTER_A--RDS--openshift_cluster
        type: cloudify.relationships.depends_on
      - target: CLUSTER_B--RDS--openshift_cluster
        type: cloudify.relationships.depends_on
      - target: CLUSTER_A--RDS--terraform
        type: cloudify.terraform.relationships.run_on_host

  kubernetes-certificate-secret-A:
    relationships:
      - type: cloudify.relationships.depends_on
        target: LOAD_BALANCER--load_balancer_dns_terraform
      - type: cloudify.kubernetes.relationships.managed_by_master
        target: CLUSTER_A--master

  kubernetes-certificate-secret-B:
    relationships:
      - type: cloudify.relationships.depends_on
        target: LOAD_BALANCER--load_balancer_dns_terraform
      - type: cloudify.kubernetes.relationships.managed_by_master
        target: CLUSTER_B--master
